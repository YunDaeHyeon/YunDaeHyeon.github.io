---
layout: post
title:  "[Spring] Spring Security의 이해 (1/2)"
date:   2022-02-07 19:20:00+0900
categories: jekyll update
tags: [spring]
---
# Spring Security의 기본제공 API와 Filter를 이해해보자. (1/2)
## Spring Security의 기능
1. 모든 Request는 **인증**이 되어야 자원의 접근이 가능하다.  
2. 개발자가 따로 구현을 안해도 기본적으로 웹 보안 기능이 작동함.  
3. Spring Security의 기본 계정, 로그인 페이지를 제공(변경 가능).  
4. **인증**방식은 Form 로그인, httpBasic 로그인 방식 제공.  
5. Server가 기동되면 Spring Security의 **초기화 작업, 보안 설정**이 진행됨.  

# 사용자 정의(개발자 정의) Security 기능 구현하기
<p align="center"><img src="/assets/img/blog/정보/spring security info 1.png"></p>

`SecurityConfig` : 사용자 정의 보안 설정 **클래스**  
`WebSecurityConfigurerAdapter` : Spring Security의 **웹 보안 기능 초기화 및 설정 클래스**
`HttpSecurity` : 세부적인 **보안** 기능 설정 API  
`인증 API` : http.formLogin(), http.logout() 등등..  
`인가 API` : http.hasRole(), http.antMatchers() 등등..  

## 사용자 정의 기능 구현하기
```java
@EnableWebSecurity // 개발자가 Spring Security의 기능을 정의하게 해주는 어노테이션
@RequiredArgsConstructor
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                .authorizeRequests()
                .antMatchers("/resources/**","/login-page","/register-page","/login-fail").permitAll()
                .antMatchers("loginAction").hasRole("USER")
                .antMatchers("loginAction").hasRole("ADMIN")
                .and()
                .formLogin()
                .loginPage("/login-page")
                .loginProcessingUrl("/login-action")
                .successHandler(new LoginSuccessHandler())
                .failureUrl("/login-fail")
                .and()
                .logout()
                .logoutUrl("/logout")
                .logoutSuccessUrl("/login-page")
                .and()
                .csrf().disable();
    }
}
! Security 설정
```
**`WebSecurityConfigurerAdapter`**을 상속받은 클래스는 개발자가 직접 **보안 설정**을 할 수 있다.  
`HttpSecurity`에 사용되는 API들은 [docs.spring.io](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html)에서 확인할 수 있다. (공식 가이드북)  

<del>왜 이렇게 어려워..</del>
  
# Login 인증 처리 프로세스 (Client <-> Server)
<p align="center"><img src="/assets/img/blog/정보/spring security info 2.png"></p>

## 과정
1. 사용자가 request를 GET 방식으로 /home에 접근시도  
2. 인증이 안되었다면 로그인 페이지로 **리다이렉트**  
3. 사용자가 POST 방식으로 `username`, `password`을 넘겨 인증 시도  
4. Server는 Spring Security가 해당 사용자의 `Session`을 생성하고, 해당 세션에 `Authorization 객체`를 생성하여 `SecurityContext`에 저장.